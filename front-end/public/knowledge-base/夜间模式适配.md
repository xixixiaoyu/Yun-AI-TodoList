# Todo 应用的夜间模式适配指南

本指南将介绍如何在 Vue 3 + TypeScript 项目中实现夜间模式（Dark Mode）适配。我们将使用 CSS 变量和 Vue 组合式函数来管理主题切换。

## 1. 定义 CSS 变量

在 `App.vue` 文件中，我们定义了两套 CSS 变量，分别对应浅色模式和深色模式：

```css
:root {
  --bg-color: #e0eafc;
  --text-color: #333;
  --card-bg-color: rgba(255, 255, 255, 0.9);
  /* 其他变量... */
}

[data-theme='dark'] {
  --bg-color: #2c3e50;
  --text-color: #ecf0f1;
  --card-bg-color: rgba(44, 62, 80, 0.9);
  /* 其他变量... */
}
```

## 2. 创建主题切换组合式函数

在 `src/composables/useTheme.ts` 文件中，我们创建了一个 `useTheme` 组合式函数来管理主题：

```typescript
import { ref, watch, onMounted, onUnmounted } from 'vue'

export function useTheme() {
  const theme = ref(localStorage.getItem('theme') || 'auto')
  const systemTheme = ref(getSystemTheme())

  // 获取系统主题
  function getSystemTheme() {
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
  }

  // 切换主题
  const toggleTheme = () => {
    if (theme.value === 'auto') {
      theme.value = systemTheme.value === 'light' ? 'dark' : 'light'
    } else {
      theme.value = theme.value === 'light' ? 'dark' : 'auto'
    }
  }

  // 更新主题
  const updateTheme = () => {
    const currentTheme = theme.value === 'auto' ? systemTheme.value : theme.value
    document.documentElement.setAttribute('data-theme', currentTheme)
  }

  // 监听主题变化
  watch([theme, systemTheme], () => {
    localStorage.setItem('theme', theme.value)
    updateTheme()
  }, { immediate: true })

  // 处理系统主题变化
  const handleSystemThemeChange = (e: MediaQueryListEvent) => {
    systemTheme.value = e.matches ? 'dark' : 'light'
  }

  // 组件挂载时添加监听器
  onMounted(() => {
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)')
    mediaQuery.addListener(handleSystemThemeChange)
    updateTheme()
  })

  // 组件卸载时移除监听器
  onUnmounted(() => {
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)')
    mediaQuery.removeListener(handleSystemThemeChange)
  })

  return {
    theme,
    systemTheme,
    toggleTheme,
  }
}
```

## 3. 在组件中使用主题切换功能

在 `TodoList.vue` 组件中，我们使用 `useTheme` 组合式函数来实现主题切换：

```vue
<script setup lang="ts">
import { useTheme } from '../composables/useTheme'

const { theme, toggleTheme } = useTheme()

// 计算主题图标
const themeIcon = computed(() => {
  if (theme.value === 'auto') {
    return 'auto'
  }
  return theme.value === 'light' ? 'moon' : 'sun'
})

// 计算主题切换提示文本
const themeTooltip = computed(() => {
  switch (theme.value) {
    case 'light':
      return t('switchToDarkMode')
    case 'dark':
      return t('switchToAutoMode')
    case 'auto':
      return t('switchToLightMode')
    default:
      return t('switchToDarkMode')
  }
})
</script>

<template>
  <button
    @click="toggleTheme"
    class="icon-button theme-toggle"
    :title="themeTooltip"
    :aria-label="themeTooltip"
  >
    <!-- 主题图标 SVG -->
  </button>
</template>
```

## 4. 使用 CSS 变量

在所有组件的样式中，我们使用定义好的 CSS 变量来设置颜色：

```css
.todo-item {
  background-color: var(--input-bg-color);
  color: var(--text-color);
  border: 1px solid var(--input-border-color);
}
```

## 5. 自动适应系统主题

通过使用 `prefers-color-scheme` 媒体查询，我们可以让应用自动适应系统主题：

```css
@media (prefers-color-scheme: dark) {
  /* 深色模式下的特定样式 */
  .todo-list {
    backdrop-filter: blur(20px);
  }
}
```

## 6. 持久化主题设置

我们使用 `localStorage` 来保存用户的主题偏好，确保在页面刷新后仍能保持选择的主题：

```typescript
localStorage.setItem('theme', theme.value)
```

## 总结

通过以上步骤，我们实现了一个灵活的夜间模式适配方案：

1. 使用 CSS 变量定义不同主题的颜色方案
2. 创建 `useTheme` 组合式函数管理主题状态和切换逻辑
3. 在组件中使用主题切换功能
4. 全局使用 CSS 变量设置样式
5. 支持自动适应系统主题
6. 持久化用户的主题偏好

这种方法不仅实现了夜间模式，还提供了良好的用户体验和性能表现。